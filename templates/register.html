<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shangri-La Referendum Registration</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<div class="page">
    <div class="card">
        <div class="logo">
            <img src="/static/logo.png" alt="Shangri-La Logo" class="logo-img">
            <h1 class="title">Voter Registration</h1>
            <p class="helper-text">
                Register for the national referendum
            </p>
            <div class="divider"></div>
        </div>

        <form id="registerForm">

            <div class="field">
                <input type="text" id="full_name" placeholder="Enter your full name" required>
            </div>

            <div class="field">
                <input type="email" id="email" placeholder="Enter your email address" required>
            </div>

            <div class="field">
                <input type="date" id="dob" required>
            </div>

            <div class="field">
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>

            <div class="field">
                <input
                    type="text"
                    id="scc"
                    placeholder="Enter your SCC code"
                    required
                    pattern="[A-Z0-9]{10}"
                    title="SCC must be exactly 10 uppercase letters or numbers">
                <small class="hint">
                    10-character code issued by the Election Authority
                </small>
            </div>

            <button type="submit">Register</button>
        </form>

        <div id="message" class="message"></div>

    </div>
</div>

<script>
    const dobInput = document.getElementById("dob");
    const today = new Date();


    const maxDate = new Date(
        today.getFullYear() - 18,
        today.getMonth(),
        today.getDate()
    );

    dobInput.max = maxDate.toISOString().split("T")[0];

    document.getElementById("registerForm").addEventListener("submit", async function(e) {
        e.preventDefault();

        const messageBox = document.getElementById("message");
        messageBox.textContent = "";
        messageBox.className = "message";
    
        scc.value = scc.value.toUpperCase();

        const data = {
            full_name: full_name.value,
            email: email.value,
            dob: dob.value,
            password: password.value,
            scc: scc.value
        };

        const response = await fetch("/mslr/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        messageBox.style.display = "block";

        if (response.ok) {
            messageBox.textContent = result.message;
            messageBox.classList.add("success");
            registerForm.reset();
        } else {
            messageBox.textContent = result.error;
            messageBox.classList.add("error");
        }
    });
</script>

</body>
</html>
